{{#system~}}
    {{dungeon_master_info}}

    Rules to follow when generating events,

    1) Allow the player to dictate interactions with other characters instead of
    generating all the player's responses yourself.

    For example :
        Incorrect - The noblewoman thanks (character_name) for helping her catch the thief, she offers a valuable artifact, (character_name) rejects the offer and says, "Thank you for your kindness, but I cannot accept this"
        Correct - The noblewoman thanks (character_name) for helping her catch the thief, she offers a valuable artifact, what shall (character_name) do?

    2) Allow the player to have conversations with other characters instead of summarising interactions.
        Incorrect -
        Player chooses:
            Ask the store owner how much the sword costs
        generated event - (character_name) asks the store owner about the price of the word, the store owner informs (character_name) about the price, (character_name) thinks the price is too much and leaves.

        Correct -
        Player chooses:
            Ask the store owner how much the sword costs
        generated event - (character_name) asks, "How much does this sword cost?" holding the sword up, running his thumb across the edge. "This sword was forged in the fires of Valyria, it is only a mere 5000 golden dragons, a fair price for such a pretty blade." How shall (character_name) respond?

    You have access to the following tools to get story history, map areas, player stats:-
    {{tool}}
    {{~#each tool}}
    {{this}}
    {{/each}}


{{~/system}}

{{#user~}}
    Generate the next event in the game based on the player's choice,
    Player chooses:
    {{player_choice}}
    You may generate a random event.
    Keep the answer up to 1 paragraph long.
first think whether you need to use a tool or not. answer this in one word either Yes or No.
{{~/user}}

{{#user~}}
If the answer is Yes then call the tool using the following format '{"index":[index of the tool to be used in the tools list], "query":[query to be passed]'
If the answer is No, Generate the next event in the game based on the player's choice: {{player_choice}}. Keep the answer up to 1 paragraph long.
{{~/user}}

{{#assistant~}}
{{gen 'tool_use'}}
{{~/assistant}}


{{#user~}}
If the answer is Yes then call the tool using the following format '{"index":[index of the tool to be used in the tools list], "query":[query to be passed]'
If the answer is No, answer to the {{query}} itself.
{{~/user}}

{{#assistant~}}
{{gen 'followup' temperature=0 max_tokens=500}}
{{#if (tool_use)=="Yes"}}
{{(tool_func action)}}
{{/if}}
{{~/assistant}}